<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>USMart - My Sales</title>

 		<!-- Google font -->
 		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">

 		<!-- Bootstrap -->
 		<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css"/>

 		<!-- Font Awesome Icon -->
 		<link rel="stylesheet" href="css/font-awesome.min.css">

 		<!-- Custom stlylesheet -->
 		<link type="text/css" rel="stylesheet" href="css/style.css"/>

        <style>
            .section {
                padding: 40px 0;
            }
            .sales-table {
                width: 100%;
                background-color: #fff;
                border: 1px solid #E4E7ED;
                border-radius: 6px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            }
            .sales-table th, .sales-table td {
                padding: 15px;
                vertical-align: middle;
            }
            .sales-table thead tr {
                border-bottom: 2px solid #4c2e71; /* USMart Purple */
                background-color: #f9f9f9;
            }
            .sales-table tbody tr {
                border-bottom: 1px solid #E4E7ED;
            }
            .sales-table tbody tr:last-child {
                border-bottom: none;
            }
            .status-pill {
                padding: 5px 10px;
                border-radius: 4px;
                font-weight: 600;
                display: inline-block;
                font-size: 0.9em;
            }
            .status-pending { background-color: #ffc107; color: #343a40; }
            .status-shipped { background-color: #007bff; color: #fff; }
            .status-delivered { background-color: #28a745; color: #fff; }
            .status-pickup { background-color: #17a2b8; color: #fff; } /* Info blue for pickup */
            .status-completed { background-color: #6c757d; color: #fff; }

            .btn-update-status {
                padding: 6px 10px;
                font-size: 0.85em;
                margin-bottom: 5px;
                white-space: nowrap;
            }
            .no-sales-message {
                text-align: center;
                padding: 50px;
                border: 1px dashed #E4E7ED;
                border-radius: 6px;
                margin-top: 20px;
                background-color: #fcfcfc;
            }
        </style>
    </head>
	<body>
		<!-- HEADER -->
		<header>
			<!-- TOP HEADER -->
		<div id="top-header">
			<div class="container">
			<ul class="header-links pull-left">
				<li><a href="#"><i class="fa fa-phone"></i> +60-4-653-3888</a></li>
				<li><a href="#"><i class="fa fa-envelope-o"></i> support@usmart.usm.my</a></li>
				<li><a href="#"><i class="fa fa-map-marker"></i> Universiti Sains Malaysia</a></li>
			</ul>
			<ul class="header-links pull-right">
				<!-- Show these links when user is NOT logged in -->
				<li id="SellerLink"><a href="profile.html"><i class="fa fa-tag"></i> Start Selling</a></li>
				<li id="loginLink"><a href="login.html"><i class="fa fa-sign-in"></i> Login</a></li>
				<li id="signupLink"><a href="signup.html"><i class="fa fa-user-plus"></i> Sign Up</a></li>
				
				<!-- Show this dropdown when user IS logged in (hidden by default) -->
				<li id="userAccount" style="display: none;">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">
						<i class="fa fa-user-o"></i> My Account
						<span class="caret"></span>
					</a>
					<ul class="dropdown-menu">
						<li><a href="profile.html"><i class="fa fa-user"></i> Profile</a></li>
						<li><a href="my-listings.html"><i class="fa fa-list"></i> My Listings</a></li>
						<li><a href="orders.html"><i class="fa fa-list-alt"></i> Order List</a></li>
						<li role="separator" class="divider"></li>
						<li><a href="logout.html"><i class="fa fa-sign-out"></i> Logout</a></li>
					</ul>
				</li>
			</ul>
		</div>
		</div>
  <div id="header">
        <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <div class="header-logo">
                        <a href="index.html" class="logo">
                            <div class="usmart-text-logo">USM<span>art</span></div>
                        </a>
                    </div>
                </div>
                <div class="col-md-9 clearfix">
                    <div class="header-ctn d-flex justify-content-end align-items-center">

                        <div>
                            <a href="mysale.html" class="account-link">
                                <i class="fa fa-money fa-lg" aria-hidden="true"></i>
                                <span>My Sale</span>
                            </a>
                        </div>
                        <div>
                            <a href="returnseller.html" class="account-link">
                                <i class="fa fa-refresh fa-lg" aria-hidden="true"></i>
                                <span>Seller Returns</span>
                            </a>
                        </div>
                        <div class="account-item">
                            <a href="addItem.html" class="account-link">
                                <i class="fa fa-plus fa-lg" aria-hidden="true"></i>
                            </a>
                            <div class="account-label" color="#fff"> Sell / Add Item</div>
                        </div>
                        </div>
                </div>
                </div>
            </div>
        </div>
    </header>	

		

		<!-- BREADCRUMB -->
		<div id="breadcrumb" class="section">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<h3 class="breadcrumb-header">My Sales Dashboard</h3>
						<ul class="breadcrumb-tree">
							<li><a href="index.html">Home</a></li>
							<li class="active">My Sales</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<!-- /BREADCRUMB -->

		<!-- SECTION -->
		<div class="section">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<div class="section-title">
							<h3 class="title">Orders to Fulfill</h3>
                            <p class="text-muted">Manage the sales you have made and update the order status for your buyers.</p>
						</div>
                        
                        <div id="salesTableContainer">
                            <div class="table-responsive">
                                <table class="table sales-table">
                                    <thead>
                                        <tr>
                                            <th>Order ID</th>
                                            <th>Product Sold</th>
                                            <th>Buyer ID</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                            <th class="text-center">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="salesList">
                                        <!-- Sales orders will be injected here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="noSales" class="no-sales-message" style="display: none;">
                            <i class="fa fa-money fa-3x mb-3" style="color:#28a745;"></i>
                            <h4>No Pending Sales Yet!</h4>
                            <p>Once a buyer purchases one of your items, the order will appear here.</p>
                            <a href="addItem.html" class="primary-btn-usm">List a New Item</a>
                        </div>
					</div>
				</div>
			</div>
		</div>
		<!-- /SECTION -->

        <!-- Confirmation Modal -->
        <div class="modal fade" id="statusModal" tabindex="-1" role="dialog" aria-labelledby="statusModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="statusModalLabel">Update Order Status</h4>
                    </div>
                    <div class="modal-body">
                        <p>Confirm status update for Order ID: <strong id="modalOrderId"></strong></p>
                        <p>Change status to: <strong id="modalNewStatus"></strong></p>
                        <div id="statusError" class="alert alert-danger" style="display:none; margin-top:15px;"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirmUpdateBtn">Confirm Update</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Confirmation Modal -->

		<!-- NEWSLETTER -->
		<div id="newsletter" class="section">
			<!-- container -->
			<div class="container">
				<!-- row -->
				<div class="row">
					<div class="col-md-12">
						<div class="newsletter">
							<p>Sign Up for the <strong>NEWSLETTER</strong></p>
							<form>
								<input class="input" type="email" placeholder="Enter Your Email">
								<button class="newsletter-btn"><i class="fa fa-envelope"></i> Subscribe</button>
							</form>
							<ul class="newsletter-follow">
								<li>
									<a href="#"><i class="fa fa-facebook"></i></a>
								</li>
								<li>
									<a href="#"><i class="fa fa-twitter"></i></a>
								</li>
								<li>
									<a href="#"><i class="fa fa-instagram"></i></a>
								</li>
								<li>
									<a href="#"><i class="fa fa-pinterest"></i></a>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<!-- /row -->
			</div>
			<!-- /container -->
		</div>
		<!-- /NEWSLETTER -->

		<!-- FOOTER -->
		<footer id="footer">
			<!-- top footer -->
			<div class="section">
				<!-- container -->
				<div class="container">
					<!-- row -->
					<div class="row">
						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">About Us</h3>
								<p>USMart is USM's trusted student marketplace for buying and selling secondhand items. We connect students across campus to trade electronics, furniture, books, and more in a safe and convenient platform. Save money, reduce waste, and support your fellow students with USMart!</p>
								<ul class="footer-links">
									<li><a href="#"><i class="fa fa-map-marker"></i>Universiti Sains Malaysia</a></li>
									<li><a href="#"><i class="fa fa-phone"></i>+60-4-653-3888</a></li>
									<li><a href="#"><i class="fa fa-envelope-o"></i>support@usmart.usm.my</a></li>
								</ul>
							</div>
						</div>

						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">Categories</h3>
								<ul class="footer-links">
									<li><a href="#">Hot deals</a></li>
									<li><a href="#">Laptops</a></li>
									<li><a href="#">Smartwatches</a></li>
									<li><a href="#">Cameras</a></li>
									<li><a href="#">Headphones</a></li>
									<li><a href="#">Smartphones</a></li>
								</ul>
							</div>
						</div>

						<div class="clearfix visible-xs"></div>

						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">Information</h3>
								<ul class="footer-links">
									<li><a href="#">About Us</a></li>
									<li><a href="#">Contact Us</a></li>
									<li><a href="#">Privacy Policy</a></li>
									<li><a href="#">Orders and Returns</a></li>
									<li><a href="#">Terms & Conditions</a></li>
								</ul>
							</div>
						</div>

						<div class="col-md-3 col-xs-6">
							<div class="footer">
								<h3 class="footer-title">Service</h3>
								<ul class="footer-links">
									<li><a href="#">My Account</a></li>
									<li><a href="#">View Cart</a></li>
									<li><a href="#">Wishlist</a></li>
									<li><a href="#">Track My Order</a></li>
									<li><a href="#">Help</a></li>
								</ul>
							</div>
						</div>
					</div>
					<!-- /row -->
				</div>
				<!-- /container -->

			</div>
			<!-- /top footer -->

			<!-- bottom footer -->
			<div id="bottom-footer" class="section">
				<div class="container">
					<!-- row -->
					<div class="row">
						<div class="col-md-12 text-center">
							<ul class="footer-payments">
								<li><a href="#"><i class="fa fa-cc-visa"></i></a></li>
								<li><a href="#"><i class="fa fa-credit-card"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-paypal"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-mastercard"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-discover"></i></a></li>
								<li><a href="#"><i class="fa fa-cc-amex"></i></a></li>
							</ul>
							<span class="copyright">
								<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
								Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
							<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
							</span>
						</div>
					</div>
						<!-- /row -->
				</div>
				<!-- /container -->
			</div>
			<!-- /bottom footer -->
		</footer>
		<!-- /FOOTER -->

		<!-- jQuery Plugins -->
		<script src="js/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
        
        <script>
            // --- MOCK DATA (Simulated Sales Orders) ---
            const dummySalesOrders = [
                { id: 'ORD-1001', product: 'Macbook Air M1', buyer: 'user-005', date: '2023-11-01', status: 'Pending', deliveryType: 'Shipped' },
                { id: 'ORD-1002', product: 'Noise Cancelling Headphones', buyer: 'user-012', date: '2023-11-05', status: 'Pending', deliveryType: 'Pickup' },
                { id: 'ORD-1003', product: 'Asus Lightweight Laptop', buyer: 'user-020', date: '2023-11-10', status: 'Shipped', deliveryType: 'Shipped' },
                { id: 'ORD-1004', product: 'Rekam Video Camera', buyer: 'user-033', date: '2023-10-25', status: 'Delivered', deliveryType: 'Pickup' },
                { id: 'ORD-1005', product: 'Wireless Mouse', buyer: 'user-040', date: '2023-10-20', status: 'Completed', deliveryType: 'Shipped' },
            ];
            
            // --- UI ELEMENTS ---
            const listEl = document.getElementById('salesList');
            const noSalesEl = document.getElementById('noSales');
            const modalOrderIdEl = document.getElementById('modalOrderId');
            const modalNewStatusEl = document.getElementById('modalNewStatus');
            const confirmUpdateBtn = document.getElementById('confirmUpdateBtn');

            let currentOrderToUpdate = null;
            let targetStatus = null;
            
            // Helper function to get status pill HTML
            function getStatusPill(status) {
                let statusClass = 'status-pending';
                if (status === 'Shipped') statusClass = 'status-shipped';
                if (status === 'Delivered') statusClass = 'status-delivered';
                if (status === 'Completed') statusClass = 'status-completed';
                if (status === 'Ready for Pickup') statusClass = 'status-pickup';

                return `<span class="status-pill ${statusClass}">${status}</span>`;
            }
            
            // --- DATA RENDERER ---
            function renderSalesOrders(orders) {
                listEl.innerHTML = '';
                
                if (orders.length === 0) {
                    document.getElementById('salesTableContainer').style.display = 'none';
                    noSalesEl.style.display = 'block';
                    return;
                }

                orders.forEach(order => {
                    const row = listEl.insertRow();
                    let actions = '';
                    
                    if (order.status === 'Pending') {
                        const nextStatus = order.deliveryType === 'Shipped' ? 'Shipped' : 'Ready for Pickup';
                        actions = `
                            <button class="btn btn-sm btn-primary btn-update-status" data-order-id="${order.id}" data-target-status="${nextStatus}" data-toggle="modal" data-target="#statusModal">
                                Mark as ${nextStatus}
                            </button>
                        `;
                    } else if (order.status === 'Shipped' || order.status === 'Ready for Pickup') {
                         actions = `
                            <button class="btn btn-sm btn-success btn-update-status" data-order-id="${order.id}" data-target-status="Delivered" data-toggle="modal" data-target="#statusModal">
                                Confirm Delivery
                            </button>
                            <span class="text-muted d-block mt-1" style="font-size:0.8em;">Waiting for buyer confirmation</span>
                        `;
                    } else if (order.status === 'Delivered') {
                         actions = `
                            <span class="text-info d-block">Awaiting Buyer Confirmation</span>
                        `;
                    } else if (order.status === 'Completed') {
                        actions = '<span class="text-success">Payment Received</span>';
                    }

                    row.innerHTML = `
                        <td><strong>#${order.id}</strong></td>
                        <td>${order.product}</td>
                        <td>${order.buyer}</td>
                        <td>${order.date}</td>
                        <td>${getStatusPill(order.status)}</td>
                        <td class="text-center">${actions}</td>
                    `;
                });

                noSalesEl.style.display = 'none';
                document.getElementById('salesTableContainer').style.display = 'block';
            }

            // --- STATUS UPDATE LOGIC ---
            // Set data for the modal when opened
            $('#statusModal').on('show.bs.modal', function(event) {
                const button = $(event.relatedTarget);
                currentOrderToUpdate = button.data('order-id');
                targetStatus = button.data('target-status');

                modalOrderIdEl.textContent = currentOrderToUpdate;
                modalNewStatusEl.textContent = targetStatus;
                
                // Set button color based on target status for visual confirmation
                const btnClass = targetStatus === 'Shipped' || targetStatus === 'Ready for Pickup' ? 'btn-primary' : 'btn-success';
                confirmUpdateBtn.className = `btn ${btnClass}`;
                confirmUpdateBtn.disabled = false;
                confirmUpdateBtn.textContent = 'Confirm Update';
            });

            // Handle confirmation button click
            confirmUpdateBtn.addEventListener('click', async () => {
                confirmUpdateBtn.disabled = true;
                confirmUpdateBtn.textContent = 'Updating...';

                if (!currentOrderToUpdate || !targetStatus) {
                    console.error('Error: Missing order ID or target status.');
                    // Display error in modal (omitted for brevity in this mock, but recommended)
                    confirmUpdateBtn.disabled = false;
                    confirmUpdateBtn.textContent = 'Confirm Update';
                    return;
                }

                try {
                    // --- MOCK LOGIC: Simulate successful update ---
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Update mock data locally for immediate visual feedback
                    const orderIndex = dummySalesOrders.findIndex(o => o.id === currentOrderToUpdate);
                    if (orderIndex > -1) {
                        dummySalesOrders[orderIndex].status = targetStatus;
                        renderSalesOrders(dummySalesOrders); // Re-render the list
                    }
                    // --- END MOCK LOGIC ---

                    $('#statusModal').modal('hide');
                    console.log(`Order ${currentOrderToUpdate} status updated to ${targetStatus}.`);

                } catch (error) {
                    console.error("Error updating status:", error);
                    // Handle real error if connected to backend
                } finally {
                    confirmUpdateBtn.textContent = 'Confirm Update';
                }
            });

            // Initialize page with mock data
            document.addEventListener('DOMContentLoaded', () => {
                renderSalesOrders(dummySalesOrders);
            });
        </script>
	</body>
</html>