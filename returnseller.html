<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>USMart - Seller Returns Dashboard</title>

 		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">

 		<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css"/>

 		<link rel="stylesheet" href="css/font-awesome.min.css">

 		<link type="text/css" rel="stylesheet" href="css/style.css"/>

        <style>
            .section {
                padding: 40px 0;
            }
            .table-responsive {
                border: 1px solid #E4E7ED;
                border-radius: 6px;
                background: #fff;
                box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            }
            .table thead tr {
                background-color: #f9f9f9;
            }
            .table > tbody > tr > td, .table > thead > tr > th {
                vertical-align: middle;
                padding: 15px;
            }
            .status-pending {  color: #FF0000; font-weight: 600; padding: 5px 10px; border-radius: 4px; }
            .status-processing { color: #5cb85c; font-weight: 600; padding: 5px 10px; border-radius: 4px; }
            .btn-approve { background-color: #5cb85c; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; margin-right: 5px; }
            .btn-chat { background-color: #4c2e71; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; }
        
            /* Styles to define the modal appearance */
            #chatModal .modal-dialog {
                width: 90%; 
                max-width: 400px; 
                margin-top: 50px;
            }
            #chatModal .modal-body {
                padding: 0;
            }
            #chatModal iframe {
                width: 100%;
                height: 70vh;
                border: none;
            }
            @media (max-width: 480px) {
                #chatModal .modal-dialog {
                    margin: 0;
                    width: 100%;
                    height: 100%;
                    max-width: 100%;
                }
                #chatModal .modal-content {
                    height: 100%;
                    border-radius: 0;
                }
                #chatModal iframe {
                    height: 100%;
                }
            }

        </style>

    </head>
	<body>
        <!-- HEADER -->
		<header>
			<!-- TOP HEADER -->
		<div id="top-header">
			<div class="container">
			<ul class="header-links pull-left">
				<li><a href="#"><i class="fa fa-phone"></i> +60-4-653-3888</a></li>
				<li><a href="#"><i class="fa fa-envelope-o"></i> support@usmart.usm.my</a></li>
				<li><a href="#"><i class="fa fa-map-marker"></i> Universiti Sains Malaysia</a></li>
			</ul>
			<ul class="header-links pull-right">
				<!-- Show these links when user is NOT logged in -->
				<li id="SellerLink"><a href="profile.html"><i class="fa fa-tag"></i> Start Selling</a></li>
				<li id="loginLink"><a href="login.html"><i class="fa fa-sign-in"></i> Login</a></li>
				<li id="signupLink"><a href="signup.html"><i class="fa fa-user-plus"></i> Sign Up</a></li>
				
				<!-- Show this dropdown when user IS logged in (hidden by default) -->
				<li id="userAccount" style="display: none;">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">
						<i class="fa fa-user-o"></i> My Account
						<span class="caret"></span>
					</a>
					<ul class="dropdown-menu">
						<li><a href="profile.html"><i class="fa fa-user"></i> Profile</a></li>
						<li><a href="my-listings.html"><i class="fa fa-list"></i> My Listings</a></li>
						<li><a href="orders.html"><i class="fa fa-list-alt"></i> Order List</a></li>
						<li role="separator" class="divider"></li>
						<li><a href="logout.html"><i class="fa fa-sign-out"></i> Logout</a></li>
					</ul>
				</li>
			</ul>
		</div>
		</div>

			<header>

    <div id="header">
        <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <div class="header-logo">
                        <a href="index.html" class="logo">
                            <div class="usmart-text-logo">USM<span>art</span></div>
                        </a>
                    </div>
                </div>
                <div class="col-md-9 clearfix">
                    <div class="header-ctn d-flex justify-content-end align-items-center">

                        <div>
                            <a href="mysale.html" class="account-link">
                                <i class="fa fa-money fa-lg" aria-hidden="true"></i>
                                <span>My Sale</span>
                            </a>
                        </div>
                        <div>
                            <a href="returnseller.html" class="account-link">
                                <i class="fa fa-refresh fa-lg" aria-hidden="true"></i>
                                <span>Seller Returns</span>
                            </a>
                        </div>
                        <div class="account-item">
                            <a href="addItem.html" class="account-link">
                                <i class="fa fa-plus fa-lg" aria-hidden="true"></i>
                            </a>
                            <div class="account-label" color="#fff"> Sell / Add Item</div>
                        </div>
                        </div>
                </div>
                </div>
            </div>
        </div>
    </header>
		</header>
		<!-- /HEADER -->	
		<div id="breadcrumb" class="section">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<h3 class="breadcrumb-header">Return Request Dashboard</h3>
						<ul class="breadcrumb-tree">
							<li><a href="index.html">Home</a></li>
							<li class="active">Return List</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="section">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
                        
                        
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Request ID</th>
                                        <th>Order ID</th>
                                        <th>Buyer ID</th>
                                        <th>Reason / Notes</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="sellerReturnsList">
                                    </tbody>
                            </table>
                        </div>

					</div>
				</div>
			</div>
		</div>
        
        <div class="modal fade" id="chatModal" tabindex="-1" role="dialog" aria-labelledby="chatModalLabel">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="chatModalLabel">Conversation</h4>
              </div>
              <div class="modal-body">
                <iframe id="chatIframe" src=""></iframe>
              </div>
            </div>
          </div>
        </div>

        
        <script src="js/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script>
            // MOCK DATA
            const mockRequests = [
                { id: 'R-7890', orderId: '12345-6789', buyerId: 'user-001', reason: 'Item arrived damaged/defective',  status: 'Pending', notes: 'Item arrived with a cracked screen.' },
                { id: 'R-7891', orderId: '12345-9876', buyerId: 'user-002', reason: 'Received incorrect item',  status: 'Pending', notes: 'Ordered red, received blue.' },
                { id: 'R-7892', orderId: '12345-1122', buyerId: 'user-003', reason: 'Item description was inaccurate', status: 'Approve', notes: 'The size listed was wrong.' },
                { id: 'R-7893', orderId: '12345-3344', buyerId: 'user-004', reason: 'Received too late', status: 'Pending', notes: 'Needed it by Monday, arrived Wednesday.' },
            ];

            function getStatusPill(status) {
                let statusClass = 'status-pending';
                if (status === 'Approve') statusClass = 'status-processing';
                // Add more status classes if needed
                return `<span class="${statusClass}">${status}</span>`;
            }

            function openChatModal(requestId, buyerId) {
                const iframe = document.getElementById('chatIframe');
                // Construct the URL with parameters and set it as the iframe source
                const chatUrl = `conversation.html?request=${requestId}&buyer=${buyerId}`;
                iframe.src = chatUrl;
                
                // Manually open the Bootstrap modal
                $('#chatModal').modal('show');
            }


            function renderSellerRequests() {
                const listEl = document.getElementById('sellerReturnsList');
                listEl.innerHTML = ''; 

                mockRequests.forEach(req => {
                    const row = listEl.insertRow();
                    row.innerHTML = `
                        <td>#${req.id}</td>
                        <td>${req.orderId}</td>
                        <td>${req.buyerId}</td>
                        <td>${req.reason}</td>
                        <td>${getStatusPill(req.status)}</td>
                        <td>
                            <button class="btn-approve" onclick="approveRequest('${req.id}')">
                                 Approve Request
                            </button>
                            <a href="#" class="btn-chat" onclick="openChatModal('${req.id}', '${req.buyerId}'); return false;">
                                <i class="fa fa-comment"></i> Chat 
                            </a>
                        </td>
                    `;
                });
            }

            function approveRequest(requestId) {
                // In a real application, this would update the database status to 'Processing' or 'Approved'.
                alert(`Request ${requestId} approved! (Status change)`);
                // Find and update the mock data's status for immediate visual feedback
                const requestToUpdate = mockRequests.find(req => req.id === requestId);
                if (requestToUpdate) {
                    requestToUpdate.status = 'Approve';
                    renderSellerRequests(); // Re-render the table
                }
            }

            // Render on page load
            window.onload = renderSellerRequests;

        </script>
	</body>
</html>